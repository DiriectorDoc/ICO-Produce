<!DOCTYPE html>
<html lang="en-CA">
	<head>
		<title>ICO Produce</title>
		<meta name="description" content="Home page" />
		<meta name="author" content="Diriector_Doc" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="last-updated" content="Sat, 10 Apr 2021 05:02 GMT" />
		<meta name="keywords" content="diriector_doc, diriectordoc, diriector doc, website, ico, milti-resolution, multiresolution, png, create, generate, icon" />
		<meta property="og:title" content="ICO Produce" />
		<meta property="og:type" content="website" />
		<meta property="og:url" content="https://diriectordoc.github.io/ICO-Produce" />
		<meta property="og:image" content="https://diriectordoc.github.io/ICO-Produce/img/" />
		<meta property="og:image:type" content="image/png" />
		<meta property="og:image:width" content="130" />
		<meta property="og:image:height" content="157" />
		<meta property="og:description" content="The home page for Diriector_Doc's creations." />
		<meta property="og:locale" content="en_CA" />
		<meta property="og:site_name" content="Diriector_Doc Pages" />
		<link href="../global.css" rel="stylesheet" type="text/css" />
		<link href="main.css" rel="stylesheet" type="text/css" />
		<script type="text/javascript" src="../global.js"></script>
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.slim.min.js"></script>
        <script type="module">
			import * as Magick from "https://cdn.jsdelivr.net/npm/wasm-imagemagick/dist/bundles/magickApi.js";

			async function command(files, command){
				return await Magick.Call(files, command.split(" "))
			}

			$(function(){
				if(window.isIE){
					alert("You are using Internet Explorer. Come aspects of this page will not load correctly.")
				}
				let File = function(source, name){
						this.content = new Uint8Array(source);
						this.name = name;
					},
					imagesToICO = async function(inputFiles){
						const cmd = "convert";
						for(let e of inputFiles){
							cmd += e.name
						}
						cmd += "icon.jpg";
						let processedFile = (await command(inputFiles, cmd))[0]
						$(".preview-images").append(`<img src="${URL.createObjectURL(processedFile.blob)}">`)
						console.log("created image " + processedFile.name)
					};
				$("input").change(async function(){
					$(".loading").show()
					let preparedImages = [],
						inputImages;
					for(let e of this.files){
						let name = e.name.replaceAll(" ", "_");
						await new Promise((resolve, reject) => {
							let img = new Image();
							img.onload = async () => {
								if(img.width != img.height || img.width > 256){
									let buffer;
									await e.arrayBuffer().then(arrayBuffer => {
										buffer = arrayBuffer
									});
									e = (await command([new File(buffer, name)], `convert -background none -gravity center ${name} -resize 256x256 -extent 256x256 ${name}.png`))[0];
									img.src = URL.createObjectURL(e)
								}
								inputImages.push(img)
								resolve()
							};
							img.onerror = reject;
							img.src = URL.createObjectURL(e)
						})

						await e.arrayBuffer().then(buffer => {
							preparedImages.push(new File(buffer, e.name.replaceAll(" ", "_")))
						})
					}
					for(let e of inputImages){
						$(".loading").append(e)
					}
					//imagesToICO(inputFiles)
				})
			})
		</script>
    </head>
    <body>
		<div class="container">
			<div class="social">
				<a href="https://github.com/DiriectorDoc/ICO-Produce" class="github"></a>
			</div>
			<div class="content-wrapper">
				<h1><img src="img/produce.png" height="80" />ICO Produce</h1>
				<div class="input-button">
					<label for="main-input">Select Image</label>
					<input id="main-input" type="file" accept="image/png, image/jpeg, image/icon" multiple />
				</div>
				<div class="preview-images">
					<img class="loading" src="img/loading.png" style="display:none" />
				</div>
			</div>
			<div class="footer asf"></div>
		</div>
    </body>
</html>